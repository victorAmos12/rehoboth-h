<div class="p-6">
  <!-- En-tête -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-[var(--color-text-primary)]">
      {{ isEditMode() ? 'Modifier le Patient' : 'Créer un Nouveau Patient' }}
    </h1>
    <p class="text-[var(--color-text-secondary)] mt-1">
      {{ isEditMode() ? 'Mettez à jour les informations du patient' : 'Ajoutez un nouveau patient au système' }}
    </p>
  </div>

  <!-- Messages -->
  @if (error()) {
    <div class="bg-red-100 border border-[var(--color-error)] text-[var(--color-error)] px-4 py-3 rounded-lg mb-6 flex items-center gap-2">
      <i class="fas fa-exclamation-circle"></i> {{ error() }}
    </div>
  }

  @if (success()) {
    <div class="bg-green-100 border border-[var(--color-success)] text-[var(--color-success)] px-4 py-3 rounded-lg mb-6 flex items-center gap-2">
      <i class="fas fa-check-circle"></i> {{ success() }}
    </div>
  }

  <!-- Formulaire -->
  @if (loading() && isEditMode()) {
    <div class="card p-8 text-center text-[var(--color-text-muted)]">
      <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
      <p>Chargement...</p>
    </div>
  } @else {
    <form (ngSubmit)="submit()" class="card overflow-hidden">
      <!-- Informations Personnelles -->
      <div class="p-6 border-b border-[var(--color-border-default)]">
        <h2 class="text-lg font-semibold text-[var(--color-text-primary)] mb-4">Informations Personnelles</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Nom et Post-Nom*</label>
            <input
              type="text"
              [value]="formData().nom"
              (change)="updatePatient('nom', $event)"
              name="nom"
              class="w-full"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Prénom *</label>
            <input
              type="text"
              [value]="formData().prenom"
              (change)="updatePatient('prenom', $event)"
              name="prenom"
              class="w-full"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Date de Naissance *</label>
            <input
              type="date"
              [value]="formData().dateNaissance"
              (change)="updatePatient('dateNaissance', $event)"
              name="dateNaissance"
              class="w-full"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Sexe *</label>
            <select
              [value]="formData().sexe"
              (change)="updatePatient('sexe', $event)"
              name="sexe"
              class="w-full"
              required
            >
              <option value="M">Masculin</option>
              <option value="F">Féminin</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Coordonnées -->
      <div class="p-6 border-b border-[var(--color-border-default)]">
        <h2 class="text-lg font-semibold text-[var(--color-text-primary)] mb-4">Coordonnées</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Email *</label>
            <input
              type="email"
              [value]="formData().email"
              (change)="updatePatient('email', $event)"
              name="email"
              class="w-full"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Téléphone *</label>
            <input
              type="tel"
              [value]="formData().telephone"
              (change)="updatePatient('telephone', $event)"
              name="telephone"
              class="w-full"
              required
            />
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Adresse</label>
            <input
              type="text"
              [value]="formData().adresse || ''"
              (change)="updatePatient('adresse', $event)"
              name="adresse"
              class="w-full"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Code Postal</label>
            <input
              type="text"
              [value]="formData().codePostal || ''"
              (change)="updatePatient('codePostal', $event)"
              name="codePostal"
              class="w-full"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Ville</label>
            <input
              type="text"
              [value]="formData().ville || ''"
              (change)="updatePatient('ville', $event)"
              name="ville"
              class="w-full"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Pays</label>
            <input
              type="text"
              [value]="formData().pays || ''"
              (change)="updatePatient('pays', $event)"
              name="pays"
              class="w-full"
            />
          </div>
        </div>
      </div>

      <!-- Informations Médicales -->
      <div class="p-6 border-b border-[var(--color-border-default)]">
        <h2 class="text-lg font-semibold text-[var(--color-text-primary)] mb-4">Informations Médicales</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Numéro de Sécurité Sociale</label>
            <input
              type="text"
              [value]="formData().numeroSecuriteSociale || ''"
              (change)="updatePatient('numeroSecuriteSociale', $event)"
              name="numeroSecuriteSociale"
              class="w-full"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Groupe Sanguin</label>
            <select
              [value]="formData().groupeSanguin || ''"
              (change)="updatePatient('groupeSanguin', $event)"
              name="groupeSanguin"
              class="w-full"
            >
              <option value="">-- Sélectionner --</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
            </select>
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Allergies</label>
            <textarea
              [value]="formData().allergies || ''"
              (change)="updatePatient('allergies', $event)"
              name="allergies"
              class="w-full"
              rows="2"
              placeholder="Énumérez les allergies connues"
            ></textarea>
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Antécédents Médicaux</label>
            <textarea
              [value]="formData().antecedentsMedicaux || ''"
              (change)="updatePatient('antecedentsMedicaux', $event)"
              name="antecedentsMedicaux"
              class="w-full"
              rows="2"
              placeholder="Décrivez les antécédents médicaux"
            ></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Médecin Traitant</label>
            <input
              type="text"
              [value]="formData().medecin_traitant || ''"
              (change)="updatePatient('medecin_traitant', $event)"
              name="medecin_traitant"
              class="w-full"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-[var(--color-text-secondary)] mb-2">Hôpital *</label>
            <input
              type="number"
              [value]="formData().hopitalId || 1"
              (change)="updatePatient('hopitalId', $event)"
              name="hopitalId"
              class="w-full"
              required
            />
          </div>
        </div>
      </div>

      <!-- Statut -->
      <div class="p-6 border-b border-[var(--color-border-default)]">
        <h2 class="text-lg font-semibold text-[var(--color-text-primary)] mb-4">Statut</h2>
        <div class="flex items-center gap-3">
          <input
            id="actif"
            type="checkbox"
            [checked]="formData().actif"
            (change)="updatePatient('actif', $event)"
            name="actif"
            class="w-5 h-5"
          />
          <label for="actif" class="text-sm font-medium text-[var(--color-text-secondary)]">Patient Actif</label>
        </div>
      </div>

      <!-- Actions -->
      <div class="bg-[var(--color-bg-hover)] p-6 flex gap-3">
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="loading()"
        >
          <i class="fas fa-save"></i> {{ isEditMode() ? 'Mettre à jour' : 'Créer' }}
        </button>
        <button
          type="button"
          (click)="cancel()"
          class="btn btn-secondary"
        >
          <i class="fas fa-times"></i> Annuler
        </button>
      </div>
    </form>
  }
</div>
